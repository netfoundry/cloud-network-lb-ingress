locals {
  user_data_be = [ for s in var.er_map_be : <<EOF
#cloud-config
package_update: true
packages:
  - keepalived
write_files:
- encoding: b64
  content: "IyEvYmluL2Jhc2gKCnNldCAtZQoKTVlJRj0kKC9zYmluL2lwIC1vIGxpbmsgc2hvdyB1cHxhd2sgJyQ5PT0iVVAiIHtwcmludCAkMjt9J3xoZWFkIC0xKQpNWUlQPSQoL3NiaW4vaXAgYWRkIHNob3cgIiR7TVlJRiU6fSJ8YXdrICckMT09ImluZXQiIHtwcmludCAkMjt9JykKCmlmIFsgIiQxIiA9PSAibWFzdGVyIiBdOyB0aGVuCiAgICB6ZncgLUkgLWMgJChlY2hvICRNWUlQIHxhd2sgLUYnLycgJ3twcmludCAkMX0nKSAtbSAzMiAtbyAwLjAuMC4wIC1uIDAgLWwgODA4MSAtaCA4MDgxIC10IDAgLXAgdGNwCmVsaWYgWyAiJDEiID09ICJiYWNrdXAiIF07IHRoZW4KICAgIHpmdyAtRCAtYyAkKGVjaG8gJE1ZSVAgfGF3ayAtRicvJyAne3ByaW50ICQxfScpIC1tIDMyIC1vIDAuMC4wLjAgLW4gMCAtbCA4MDgxIC1oIDgwODEgLXQgMCAtcCB0Y3AKZWxzZQogICAgZWNobyAibm8gdmFsaWQgYXJndW1lbnQgcGFzc2VkIgpmaQo="
  owner: root:root
  path: /opt/netfoundry/vrrp_notify.sh
  permissions: '0755'
- encoding: b64
  content: "Z2xvYmFsX2RlZnMgewogICAgICAgIHNjcmlwdF91c2VyIHppZ2d5IHppZ2d5CiAgICAgICAgZW5hYmxlX3NjcmlwdF9zZWN1cml0eQp9CnZycnBfc2NyaXB0IHdhbl9jaGVjayB7CiAgICAgICAgc2NyaXB0ICIvb3B0L25ldGZvdW5kcnkvZXJoY2hlY2tlci5weXoiCiAgICAgICAgaW50ZXJ2YWwgMwogICAgICAgIHJpc2UgMgogICAgICAgIGZhbGwgMgogICAgICAgIHVzZXIgemlnZ3kgemlnZ3kKfQp2cnJwX2luc3RhbmNlIFZJXzEgewogICAgICAgIGludGVyZmFjZSBlbnAwczUKICAgICAgICB2aXJ0dWFsX3JvdXRlcl9pZCA1MQogICAgICAgIGNoZWNrX3VuaWNhc3Rfc3JjCiAgICAgICAgdHJhY2tfc2NyaXB0IHsKICAgICAgICAgICAgICAgIHdhbl9jaGVjawogICAgICAgIH0KICAgICAgICBub3RpZnlfbWFzdGVyICIvb3B0L25ldGZvdW5kcnkvdnJycF9ub3RpZnkuc2ggbWFzdGVyIiByb290IHJvb3QKICAgICAgICBub3RpZnlfZmF1bHQgIi9vcHQvbmV0Zm91bmRyeS92cnJwX25vdGlmeS5zaCBiYWNrdXAiIHJvb3Qgcm9vdAp9"
  owner: root:root
  path: /etc/keepalived/keepalived.conf
  permissions: '0644'
- encoding: b64
  content: "IyEvYmluL2Jhc2gKCiMgVmFyaWFibGVzCkNMT1VEX1pJVElfSE9NRT0iL29wdC9uZXRmb3VuZHJ5IgpPUEVOX1pJVElfSE9NRT0iL29wdC9vcGVueml0aSIKWklUSV9IT01FPSIke0NMT1VEX1pJVElfSE9NRX0veml0aSIKWklUSV9DTEk9IiR7WklUSV9IT01FfS96aXRpIgpFQlBGX0JJTj0iJHtPUEVOX1pJVElfSE9NRX0vYmluIgoKIyBEaXZlcnRlciB1cGRhdGUgZnVuY3Rpb24gdG8gdGhlIGxhdGVzdCB2ZXJzaW9uCmRpdmVydGVyX3VwZGF0ZSgpIHsKICBpZiBbWyAkKCR7WklUSV9DTEl9IC0tdmVyc2lvbiB8IGN1dCAtZCJ2IiAtZiAyKSA+ICIwLjI3LjIiIF1dOyB0aGVuCiAgICBhcmNoPWB1bmFtZSAtbWAKICAgIGlmIFsgJGFyY2ggPT0gIng4Nl82NCIgXTsgdGhlbgogICAgICBhcmNoPSJhbWQ2NCIKICAgIGZpCiAgICBicm93c2VyX2Rvd25sb2FkX3VybD1gY3VybCAtcyBodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zL25ldGZvdW5kcnkvemZ3L3JlbGVhc2VzL2xhdGVzdCB8IGpxIC0tYXJnIGFyY2ggJGFyY2ggLXIgJy5hc3NldHNbXSB8IHNlbGVjdCgoLm5hbWUgfCB0ZXN0KCJyb3V0ZXIiKSkgYW5kICgubmFtZSB8IHRlc3QoJGFyY2gpKSkuYnJvd3Nlcl9kb3dubG9hZF91cmwnYAogICAgY3VybCAtc0wgJGJyb3dzZXJfZG93bmxvYWRfdXJsID4gL3RtcC96ZncuZGViCiAgICBzdWRvIGRwa2cgLWkgL3RtcC96ZncuZGViCiAgICBybSAvdG1wL3pmdy5kZWIKICAgIHN1ZG8gemZ3IC1RCiAgICBzdWRvIHN5c3RlbWN0bCByZXN0YXJ0IHppdGktcm91dGVyCiAgZWxzZQogICAgZWNobyAiSU5GTzogZWJwZiBjYW5ub3QgYmUgaW5zdGFsbGVkLCB0aGUgaW5zdGFsbGVkIHppdGkgdmVyc2lvbiBpcyBub3QgMC4yNy4zIG9yIGhpZ2hlci4iCiAgZmkKfQojIERpdmVydGVyIGVuYWJsZSBmdW5jdGlvbgpkaXZlcnRlcl9lbmFibGUoKSB7CiAgc3RhdHVzPWBkcGtnIC1zIHpmdy1yb3V0ZXIgMj4vZGV2L251bGxgCiAgaWYgW1sgYGVjaG8gJHN0YXR1cyB8YXdrIC1GJ1tbOnNwYWNlOl1dK3w9JyAne3ByaW50ICQ0fSdgID09ICJpbnN0YWxsIiBdXSAmJiBbWyAtZiAkRUJQRl9CSU4vc3RhcnRfZWJwZl9yb3V0ZXIucHkgXV07IHRoZW4KICAgIHN1ZG8gJEVCUEZfQklOL3N0YXJ0X2VicGZfcm91dGVyLnB5CiAgICBzdWRvIHN5c3RlbWN0bCByZXN0YXJ0IHppdGktCiAgICB6ZndfbG9nX2lzX2FjdGl2ZT1gc3lzdGVtY3RsIGlzLWFjdGl2ZSB6ZnctbG9nZ2luZy5zZXJ2aWNlYAogICAgemZ3X2xvZ19pc19lbmFibGVkPWBzeXN0ZW1jdGwgaXMtZW5hYmxlZCB6ZnctbG9nZ2luZy5zZXJ2aWNlYAogICAgaWYgW1sgIiR6ZndfbG9nX2lzX2FjdGl2ZSIgPT0gImluYWN0aXZlIiBdXTsgdGhlbgogICAgICBzdWRvIHN5c3RlbWN0bCBzdGFydCB6ZnctbG9nZ2luZy5zZXJ2aWNlCiAgICBmaQogICAgaWYgW1sgIiR6ZndfbG9nX2lzX2VuYWJsZWQiID09ICJkaXNhYmxlZCIgXV07IHRoZW4KICAgICAgc3VkbyBzeXN0ZW1jdGwgZW5hYmxlIHpmdy1sb2dnaW5nLnNlcnZpY2UKICAgIGZpCiAgZWxzZSAKICAgIGVjaG8gJ0lORk86IGVicGYgbm90IGluc3RhbGxlZCwgcnVuIGRpdmVydGVyLXVwZGF0ZSB0byBpbnN0YWxsIGl0LicKICBmaQp9CiMgSGVhbHRoIENoZWNrZXIgU2NyaXB0IHVwZGF0ZSBmdW5jdGlvbiB0byB0aGUgbGF0ZXN0IHZlcnNpb24KZXJoY2hlY2tlcl91cGRhdGUoKSB7CiAgaWYgW1sgJCgke1pJVElfQ0xJfSAtLXZlcnNpb24gfCBjdXQgLWQidiIgLWYgMikgPiAiMC4yOC4wIiBdXTsgdGhlbgogICAgYXJjaD1gdW5hbWUgLW1gCiAgICBpZiBbICRhcmNoID09ICJ4ODZfNjQiIF07IHRoZW4KICAgICAgYXJjaD0iYW1kNjQiCiAgICBmaQogICAgYnJvd3Nlcl9kb3dubG9hZF91cmw9YGN1cmwgLXMgaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9uZXRmb3VuZHJ5L2VkZ2Utcm91dGVyLWhlYWx0aC1jaGVja2VyL3JlbGVhc2VzL2xhdGVzdCB8IGpxIC0tYXJnIGFyY2ggJGFyY2ggLXIgJy5hc3NldHNbXSB8IHNlbGVjdCgubmFtZSB8IHRlc3QoJGFyY2gpKS5icm93c2VyX2Rvd25sb2FkX3VybCdgCiAgICBjdXJsIC1zTCAkYnJvd3Nlcl9kb3dubG9hZF91cmwgPiAvdG1wL2VyaGNoZWNrZXIudGFyLmd6CiAgICBzdWRvIHRhciB4emYgL3RtcC9lcmhjaGVja2VyLnRhci5neiAtQyAkQ0xPVURfWklUSV9IT01FCiAgICBybSAvdG1wL2VyaGNoZWNrZXIudGFyLmd6CiAgZWxzZQogICAgZWNobyAiSU5GTzogZXJoY2hlY2tlciBzY3JpcHQgY2Fubm90IGJlIGluc3RhbGxlZCwgdGhlIGluc3RhbGxlZCB6aXRpIHZlcnNpb24gaXMgbm90IDAuMjguMSBvciBoaWdoZXIuIgogIGZpCn0KCiMjIyBNYWluCmRpdmVydGVyX3VwZGF0ZQpkaXZlcnRlcl9lbmFibGUKZXJoY2hlY2tlcl91cGRhdGUK"
  owner: root:root
  path: /var/lib/cloud/diverter.sh
  permissions: '0755'
- content: |
    #Netfoundry Added file
    [Resolve]
    DNS=100.127.255.254
  owner: root:root
  path: /var/lib/cloud/01-netfoundry.conf
  permissions: '0644'
runcmd:
- |
  LANIF="$(/sbin/ip -o link show up|awk '$9=="UP" {print $2;}'|head -1|tr -d ":")"
  /opt/netfoundry/router-registration --dnsIPRange ${s.dnsSvcIpRange} --tunnel_ip 100.127.255.254 --lanIf $LANIF ${s.edgeRouterKey}
  /var/lib/cloud/diverter.sh
  /usr/bin/systemctl restart keepalived.service
EOF
  ]
  # flatten_list = {
  #     for item in flatten([
  #         for table in module.vpc1.public_route_table_ids : [
  #             for vm in module.compute_backend.*.id: {
  #                 vm = vm
  #                 table = table
  #             }
  #         ] 
  #     ])
  #     : item.vm => item
  # }
  user_data_client = [ for s in var.er_map_be : <<EOF
#cloud-config
package_update: 
write_files:
- encoding: b64
  content: "IyEvYmluL2Jhc2gKZGVjbGFyZSAtYSBob3N0cz0oCgkic2FwcGFzMDEuYXRjLmludGVybmFsIgoJImxhbXBhcGFzcnAxLnNhcC5sYW1vc2EuY29tIgoJImxhZWRkYzAxLnNhcC5sYW1vc2EuY29tIgoJIm10c3B3cGNuc2FwdnExMS5zYXAubm92aXMuY2wiCgkic2FtcGxwcmRzYXAwMS5zYXAuc2FhbXRlcm1pbmFscy5jb20iCgkjInNwdHBscHJkc2FwMDEuc2FwLnNhYW10ZXJtaW5hbHMuY29tIgoJInVjbXBsY3Nwc2FwdnExMS5zYXAudWNtLmNsIgoJInZwNnBhczAxLmF0Yy5pbnRlcm5hbCIKCSJtc2xkd2VjZHNhcHZ0MTEudGVuYW50MDEubm92aXMuY2wiCgkiY2QxcGFzMDEuYXRjLmludGVybmFsIgoJImxhZWJrcDAxLnNhcC5sYW1vc2EuY29tIgoJIyJhZ3Nxd2NpbnRpby5zYXAuYWd1bnNhLmxvY2FsIgoJInNrc2R3ZGUwc2FwdnExMi5zYXAubm92aXMuY2wiCgkjImJjaHBsYTAyZXJwLnNhcC5iY2VudHJhbC5jbCIKCSJ3ajJwYXMwMS5hdGMuaW50ZXJuYWwiCgkiandkcGFzMDEuYXRjLmludGVybmFsIgoJImxobG1zamxtZGJqLnNhcC5sYW1vc2EuY29tIgoJInBwMnBhczAxLmF0Yy5pbnRlcm5hbCIKCSJsYWpwYXAwMWRyLnNhcC5sYW1vc2EuY29tIgoJIm10cnB3Y2luZ3JwLnNhcC5tZXRyby5jbCIKCSJiY2hsYnBvcC5zYXAuYmNlbnRyYWwuY2wiCgkibGFtZGFwYXNyZDEuc2FwLmxhbW9zYS5jb20iCgkibGxlbXBvcWphczAxLmdjcC5sYWV1cm9wZWEuY29tLm14IgoJInNhcHBhczAxLmF0Yy5pbnRlcm5hbCIKCSJyY2RwYXNmaXEuc2FwLnJjZGhvdGVscy5jb20iCgkibGFtcWFwYXNycTEuc2FwLmxhbW9zYS5jb20iCgkibGFscGRjMDFkci5zYXAubGFtb3NhLmNvbSIKCSJwcDFwYXMwMS5hdGMuaW50ZXJuYWwiCgkjInNhbXBscHJkc2FwMDEuc2FwLnNhYW0uY2wiCgkibGxtc3Njc2pwMWRyLnNhcC5sYW1vc2EuY29tIgoJInNrc3B3cHIwc2FwdnExMi5zYXAubm92aXMuY2wiCgkibGxtc3BkYjJqcDEuc2FwLmxhbW9zYS5jb20iCgkibGxtc3BsYWFzamNwLnNhcC5sYW1vc2EuY29tIgoJImJjaGRsc2NzcG9kLnNhcC5iY2VudHJhbC5jbCIKCSJlbmdkd2RjM3NhcHZ0MTEuc2FwLm5vdmlzLmNsIgoJImxsbXNwbGFzY2xwMS5zYXAubGFtb3NhLmNvbSIKCSJzYjJwYXMwMS5ub3Zpc2xhYnMuaW50ZXJuYWwiCgkiY2Q0cGFzMDEuYXRjLmludGVybmFsIgoJImJjaHFscGFzcWFzLnNhcC5iY2VudHJhbC5jbCIKCSJsbG1zcGxwYWFlcDEuc2FwLmxhbW9zYS5jb20iCgkid3EycGFzMDEuYXRjLmludGVybmFsIgoJIkJDSFBMRVJQU0FQMDVsLlNBUC5CQ0VOVFJBTC5DTCIKCSJsbG1zcGRiMmpjcDEuc2FwLmxhbW9zYS5jb20iCgkic2tzcXd0czBzYXB2cTEyLnNhcC5ub3Zpcy5jbCIKCSMiYmNocGxhMDFlcnAuc2FwLmJjZW50cmFsLmNsIgoJIyJocWNwbHByZHNhcDAxLnNhcC5odWVxdWVjdXJhLmNsIgoJIyJ2YWxtc3BscnAyMDEuc2FwLmxhbW9zYS5jb20iCgkibGxtc3Bhc2pjcGRyLnNhcC5sYW1vc2EuY29tIgoJImJjaHBscGExcG9wLnNhcC5iY2VudHJhbC5jbCIKCSJsbG1zcXBhc2pjcTEuc2FwLmxhbW9zYS5jb20iCgkiQkNIUExFUlBTQVAwMS5zYXAuYmNlbnRyYWwuY2wiCgkibGhsbXNzbG1wYXMuc2FwLmxhbW9zYS5jb20iCgkjIkJDSFBMRVJQU0FQMDIuc2FwLmJjZW50cmFsLmNsIgoJIm52c2R3ZGVjc3FsLnNhcG52cy5ub3Zpcy5jbCIKCSJudnNwd2NpbnByYy5zYXBudnMubm92aXMuY2wiCgkiZW1icGxoY2NzYXB2cTExLnNhcC5lbWJvbm9yLmNsIgoJImZqY3Bsc2FwczR4LmdjcC5sYWNvcm9uYS5jb20ubXgiCgkibGxtc3BsYWFzanAxLnNhcC5sYW1vc2EuY29tIgoJImxobG1zamxtc2NzLnNhcC5sYW1vc2EuY29tIgoJImxhbGRkYzAxLnNhcC5sYW1vc2EuY29tIgoJInJjZHBhc2Rwby5zYXAucmNkaG90ZWxzLmNvbSIKCSMibGhsbXNzbG1kYmEuc2FwLmxhbW9zYS5jb20iCgkibGxtc3BsZXJzbHAxLnNhcC5sYW1vc2EuY29tIgoJIndqM3BhczAxLmF0Yy5pbnRlcm5hbCIKCSJsYWVxZGMwMS5zYXAubGFtb3NhLmNvbSIKCSJtdHNkd2RjbnNhcHZxMTEuc2FwLm5vdmlzLmNsIgoJInZhbG1zcGxjcDIwMS5zYXAubGFtb3NhLmNvbSIKCSMiYXJ6cGxwcmRzYXAwMS5zYXAuYXJpenRpYS5jb20iCgkibnZzcXdjaW50ZWMuc2FwbnZzLm5vdmlzLmNsIgoJImxhY3FkYzAxLnNhcC5sYW1vc2EuY29tIgoJIyJhZ3Nwd2RiYXNieC5zYXAuYWd1bnNhLmxvY2FsIgoJImh3M3BhczAxLmF0Yy5pbnRlcm5hbCIKCSJiY2hxbHNjc3BvcS5zYXAuYmNlbnRyYWwuY2wiCgkic2tzZHdkZTBzYXB2dDExLnNhcC5ub3Zpcy5jbCIKCSJsYWNwZGMwMWRyLnNhcC5sYW1vc2EuY29tIgoJInVjbWRsZHBvc2FwdnExMS5zYXAudWNtLmNsIgoJInJjZHBhc2Ridy5zYXAucmNkaG90ZWxzLmNvbSIKCSJ1Y21xbHFwb3NhcHZxMTEuc2FwLnVjbS5jbCIKCSJzcHRxbGNpbnFhcy5zYXAuc2FhbXRlcm1pbmFscy5jb20iCgkibGF3ZGRjMDEuc2FwLmxhbW9zYS5jb20iCgkic2Fwc29sMDEubm92aXNsYWJzLmludGVybmFsIgoJImVtYnBsaGNpc2FwdnExMS5zYXAuZW1ib25vci5jbCIKCSJsaGxtc2psbXBhcy5zYXAubGFtb3NhLmNvbSIKCSJzYW1xbGNpbnFhcy5zYXAuc2FhbS5jbCIKCSJtc2xwd2VjcHNhcHZ0MTEudGVuYW50MDEubm92aXMuY2wiCgkiaGE3cGFzMDEuYXRjLmludGVybmFsIgoJIyJodGZwbHByZGNpbnZhMDEuc2FwLmhvcnRpZnJ1dC5jbCIKCSJza3Nxd3RzMHNhcHZ0MTEuc2FwLm5vdmlzLmNsIgoJIyJiY2hwbGVycHNhcDA1LnNhcC5iY2VudHJhbC5jbCIKCSJ2cDZhc2NzLmF0Yy5pbnRlcm5hbCIKCSJzbG1wYXMwMS5hdGMuaW50ZXJuYWwiCgkibGxtc3BzY3NqY3AxLnNhcC5sYW1vc2EuY29tIgoJImJjaHBsYTA0ZXJwLnNhcC5iY2VudHJhbC5jbCIKCSJ2aGJtbnNocWFzMDEuZ2NwLmJhbm9ydGUuY29tIgoJIyJCQ0hQTEVSUFNBUDA0LnNhcC5iY2VudHJhbC5jbCIKCSMidmFsbXNwbGNwMjAyLnNhcC5sYW1vc2EuY29tIgoJInJjZHBhc2ZpZC5zYXAucmNkaG90ZWxzLmNvbSIKCSJsYXdxZGMwMS5zYXAubGFtb3NhLmNvbSIKCSJwbzBwYXMwMS5hdGMuaW50ZXJuYWwiCgkibnZzcHdzcGFzYXB2cTExLnNlcnZpY2lvLm5vdmlzLmNsIgoJImVuZ3B3cGMzc2FwdnQxMS5zYXAubm92aXMuY2wiCgkjImFyenBscHJkc2FwMDIuc2FwLmFyaXp0aWEuY29tIgoJIndqM2FzY3MuYXRjLmludGVybmFsIgoJImxhbXB3c2NzenAxLnNhcC5sYW1vc2EuY29tIgoJIm52c3B3c3Bqc2FwdnExMS5zZXJ2aWNpby5ub3Zpcy5jbCIKCSJsbG1zcGxhcHBqcDEuc2FwLmxhbW9zYS5jb20iCgkibXRzcXd0Y25zYXB2cTExLnNhcC5ub3Zpcy5jbCIKCSJsbG1zcGFwcDE1LnNhcC5sYW1vc2EuY29tIgoJImxsbXNwYXBwMTQuc2FwLmxhbW9zYS5jb20iCgkibGxlbWZpcGFhczAxLmdjcC5sYWV1cm9wZWEuY29tLm14IgoJInBvOXBhczAxLmF0Yy5pbnRlcm5hbCIKCSJiY2hwbGEwM2VycC5zYXAuYmNlbnRyYWwuY2wiCgkibGFqcGFwMDEuc2FwLmxhbW9zYS5jb20iCgkic2FtcGxjaW5wcmQuc2FwLnNhYW0uY2wiCgkjImFyenBscHJkc2FwMDMuc2FwLmFyaXp0aWEuY29tIgoJInZhbG1zcGxlcDExMS5zYXAubGFtb3NhLmNvbSIKCSJsYWxwZGMwMS5zYXAubGFtb3NhLmNvbSIKCSJudnNkd2NpbmRlYy5zYXBudnMubm92aXMuY2wiCgkjIkJDSFBMRVJQU0FQMDMuc2FwLmJjZW50cmFsLmNsIgoJImZ0bGRscGFzZmR4LmF3cy5mZXJ0aW5hbC5jb20iCgkibGFqZGFwMDEuc2FwLmxhbW9zYS5jb20iCgkjImhxY3BscHJkc2FwMDEuc2FwLmh1ZXF1ZWN1cmEuY2wiCgkicmNkaGRiZGV2LnNhcC5yY2Rob3RlbHMuY29tIgoJIndkMXBhczAxLmF0Yy5pbnRlcm5hbCIKCSJiY2hxbHBhc3BvcS5zYXAuYmNlbnRyYWwuY2wiCgkibGxtc3BscGFzamNwLnNhcC5sYW1vc2EuY29tIgoJInNmZnB3cHJzc2FwdnQxMi5zYXAub3RpY3NvZm9mYS5jbCIKCSMiY2EiCgkicnNuZHdkZWtzYXB2cTExLnRlbmFudDAxLm5vdmlzLmNsIgoJInNwdHNsY2luZGV2LnNhcC5zYWFtdGVybWluYWxzLmNvbSIKCSJyY2RwYXN0c3Quc2FwLnJjZGhvdGVscy5jb20iCgkic2ZmZHdkZXNzYXB2dDExLnNhcC5vdGljc29mb2ZhLmNsIgoJImp3ZGFzY3MuYXRjLmludGVybmFsIgoJImoxZGFzY3MuYXRjLmludGVybmFsIgoJInJjZHBhc2Rldi5zYXAucmNkaG90ZWxzLmNvbSIKCSJ2aGJtbnNocGFzMDEuZ2NwLmJhbm9ydGUuY29tIgoJImxsbXNxZGJhZXExLnNhcC5sYW1vc2EuY29tIgoJImxsbXNwbGFzY2pwMS5zYXAubGFtb3NhLmNvbSIKCSJzYXBwYXMwMS5hdGMuaW50ZXJuYWwiCgkiaHRmcGxwcmRwYXMuc2FwLmhvcnRpZnJ1dC5jbCIKCSJsbG1zcXNjc2p3cTEuc2FwLmxhbW9zYS5jb20iCgkicmNkaGRiZGJ3LnNhcC5yY2Rob3RlbHMuY29tIgoJImxsbXNwbGVyc2pwMS5zYXAubGFtb3NhLmNvbSIKCSJ3cTJwYXMwMS5hdGMuaW50ZXJuYWwiCgkibGxlbXFzbGFhczAxLmdjcC5sYWV1cm9wZWEuY29tLm14IgoJIm52c2R3YXNjZGVjLnNhcG52cy5ub3Zpcy5jbCIKCSJsbG1zcGxkYmFscDEuc2FwLmxhbW9zYS5jb20iCgkibGxtc3BhcHAxNi5zYXAubGFtb3NhLmNvbSIKCSJzYXAtcHJvZC0zLnNhcC5ub3Zpcy5jbCIKCSJsbG1zcXNjc2pjcTEuc2FwLmxhbW9zYS5jb20iCgkibG1zcGFzdGVzLnNhcC5sYW1vc2EuY29tIgoJImoxZHBhczAxLmF0Yy5pbnRlcm5hbCIKCSJsbG1zcGFzc2J4LnNhcC5sYW1vc2EuY29tIgoJImh0ZnBscHJkc2FwMDMuc2FwLmhvcnRpZnJ1dC5jbCIKCSJsbG1zc2NzamNwZHIuc2FwLmxhbW9zYS5jb20iCgkjImFnc2R3Y2luZGlvLnNhcC5hZ3Vuc2EubG9jYWwiCgkibXNscXdlY3FzYXB2dDExLnRlbmFudDAxLm5vdmlzLmNsIgoJInJjZGhkYnRzdC5zYXAucmNkaG90ZWxzLmNvbSIKCSJiY2hwbHBhMnBvcC5zYXAuYmNlbnRyYWwuY2wiCgkicnNucXd0ZWtzYXB2cTExLnRlbmFudDAxLm5vdmlzLmNsIgoJInNrc3B3cHIwc2FwdnQxMS5zYXAubm92aXMuY2wiCgkic2Ftc2xjaW5kZXYuc2FwLnNhYW0uY2wiCgkiZW5ncXd0YzNzYXB2dDExLnNhcC5ub3Zpcy5jbCIKCSJ3ajJhc2NzLmF0Yy5pbnRlcm5hbCIKCSJzcHRzbGFzY2Rldi5zYXAuc2FhbXRlcm1pbmFscy5jb20iCgkibGxlbXBzbGFhczAxLmdjcC5sYWV1cm9wZWEuY29tLm14IgoJIyJ0YXlwbHByZHNhcDAxLnNhcC50YXlsb3IuY2wiCgkibGxtc3BzY3NqY3AxLnNhcC5sYW1vc2EuY29tIgoJIndxM3BhczAxLmF0Yy5pbnRlcm5hbCIKCSJodGZwbHByZGFzYy5zYXAuaG9ydGlmcnV0LmNsIgoJImxsZW1ld3FhYXMwMS5nY3AubGFldXJvcGVhLmNvbS5teCIKCSJsbG1zcXBhc2p3cTEuc2FwLmxhbW9zYS5jb20iCgkiZW1icGxzcHJzYXB2cTExLnNhcC5lbWJvbm9yLmNsIgoJInNmZnF3cWFzc2FwdnQxMS5zYXAub3RpY3NvZm9mYS5jbCIKCSJPWFFRV1RDVFNBUDAxLnNhcC5veGlxdWltLmNsIgoJIkNGT1BXUENHU0FQVlQxMy5zYXAuY29yZm8uY2wiCgkpCiMjIG5vdyBsb29wIHRocm91Z2ggdGhlIGFib3ZlIGFycmF5CkNPVU5URVI9MAp3aGlsZSB0cnVlCmRvIAoJZm9yIGhvc3QgaW4gIiR7aG9zdHNbQF19IgoJZG8KCQljdXJsIC0tY29ubmVjdC10aW1lb3V0IDUgLXMgLW8gL2Rldi9udWxsIC13ICIkaG9zdCAtLT5cbiAgICQoZGF0ZSlcbiAgIHVybDogJXt1cmxfZWZmZWN0aXZlfVxuICAgZHN0LWlwOiAle3JlbW90ZV9pcH1cbiAgIGRzdC1wb3J0OiAle3JlbW90ZV9wb3J0fVxuICAgcmVzcG9uc2UtY29kZTogJXtyZXNwb25zZV9jb2RlfVxuICAgbmFtZS1sb29rdXAtdGltZTogJXt0aW1lX25hbWVsb29rdXB9XG4iIGh0dHBzOi8vIiRob3N0Ijo4MDgxL2hlYWx0aC1jaGVja3MgLWsKCQkjbnNsb29rdXAgJGhvc3QgfCBncmVwICJBZGRyZXNzOiAxMDAiCglkb25lCgkjIHNsZWVwIDEKCUNPVU5URVI9JCgoJENPVU5URVIgKzEpKQoJZWNobyAiTG9vcCBudW1iZXIgaXMgJENPVU5URVIiCmRvbmU="
  owner: root:root
  path: /opt/netfoundry/curl.sh
  permissions: '0755'
runcmd:
- |
  sed -i 's/#DNS=/DNS=100.127.255.254/g' /etc/systemd/resolved.conf
  /usr/bin/systemctl restart systemd-resolved.service
  nohup /opt/netfoundry/curl.sh > /var/log/curl.log 2>&1 &
EOF
  ]
}